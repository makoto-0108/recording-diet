<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ダイエット記録アプリ</title>
<style>
  body { font-family: sans-serif; margin: 20px; }
  input, select, button { margin: 5px; padding: 5px; }
  ul { list-style: none; padding: 0; }
  li { margin: 5px 0; }
  h1, h2 { color: #333; }
  button { cursor: pointer; }
  .edit-btn { background: #ffc107; border: none; padding: 3px 8px; margin-left: 5px; }
  .delete-btn { background: #f44336; color: white; border: none; padding: 3px 8px; margin-left: 5px; }
</style>
</head>
<body>
<h1>ダイエット記録</h1>

<form id="recordForm">
  <label>日付: <input type="date" id="date" required></label>
  <label>食事: 
    <select id="meal">
      <option>朝食</option>
      <option>昼食</option>
      <option>夕食</option>
      <option>間食</option>
    </select>
  </label>
  <label>カロリー: <input type="number" id="calories" required> kcal</label>
  <button type="submit">記録</button>
</form>

<h2>最新3件</h2>
<ul id="latest"></ul>

<h2>全履歴</h2>
<ul id="all"></ul>

<script>
const form = document.getElementById("recordForm");
const dateInput = document.getElementById("date");
const mealInput = document.getElementById("meal");
const caloriesInput = document.getElementById("calories");
const latestList = document.getElementById("latest");
const allList = document.getElementById("all");

let records = JSON.parse(localStorage.getItem("records") || "[]");

function saveRecords(){
  localStorage.setItem("records", JSON.stringify(records));
}

// ✅ 日付ズレ防止版
function formatDate(dateStr){
  if(!dateStr) return '';
  const [y, m, d] = dateStr.split('-');
  return `${y}年${parseInt(m)}月${parseInt(d)}日`;
}

function render(){
  latestList.innerHTML = "";
  allList.innerHTML = "";

  const latest3 = records.slice(-3);

  // 最新3件の表示
  latest3.forEach((rec)=>{
    const idx = records.findIndex(r => 
      r.date === rec.date && r.meal === rec.meal && r.calories === rec.calories
    );
    const li = document.createElement("li");
    li.innerHTML = `
      ${formatDate(rec.date)} ${rec.meal} - ${rec.calories}kcal
      <button class="edit-btn" data-index="${idx}">編集</button>
      <button class="delete-btn" data-index="${idx}">削除</button>
    `;
    latestList.appendChild(li);
  });

  // 全履歴の表示
  records.forEach((rec,i)=>{
    const li = document.createElement("li");
    li.innerHTML = `
      ${formatDate(rec.date)} ${rec.meal} - ${rec.calories}kcal
      <button class="edit-btn" data-index="${i}">編集</button>
      <button class="delete-btn" data-index="${i}">削除</button>
    `;
    allList.appendChild(li);
  });
}

form.addEventListener("submit", e=>{
  e.preventDefault();
  const newRec = {
    date: dateInput.value,
    meal: mealInput.value,
    calories: caloriesInput.value
  };
  records.push(newRec);
  saveRecords();
  render();
  form.reset();
});

document.body.addEventListener("click", e=>{
  if(e.target.classList.contains("delete-btn")){
    const idx = e.target.dataset.index;
    records.splice(idx,1);
    saveRecords();
    render();
  }
  if(e.target.classList.contains("edit-btn")){
    const idx = e.target.dataset.index;
    const rec = records[idx];
    dateInput.value = rec.date;
    mealInput.value = rec.meal;
    caloriesInput.value = rec.calories;
    records.splice(idx,1); // 編集時はいったん削除
    saveRecords();
    render();
  }
});

// 初期表示
render();
</script>
</body>
</html>
